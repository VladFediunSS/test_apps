<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Styled Select Test</title>
  <style>
    /* minimal "native-like" dropdown container */
    #select-wrap { position: relative; display: inline-block; }
    #select-list {
      position: absolute;
      top: 100%;
      left: 0;
      width: 100%;
      margin: 2px 0 0;
      padding: 0;
      list-style: none;
      border: 1px solid #000;
      background: #fff;
    }
    #select-list li { padding: 2px 4px; cursor: default; }
  </style>
</head>
<body>

  <h1>styled-select-test.html</h1>

  <p><strong>Styled select</strong></p>

  <span id="select-wrap">
    <!-- Trigger -->
    <button
      id="select-trigger"
      aria-haspopup="listbox"
      aria-expanded="false"
      aria-controls="select-list"
      data-testid="select-trigger"
      type="button"
    >
      Choose option
    </button>

    <!-- Options -->
    <ul id="select-list" role="listbox" hidden data-testid="select-list">
      <li role="option" data-value="A">Option A</li>
      <li role="option" data-value="B">Option B</li>
      <li role="option" data-value="C" aria-disabled="true">Option C (disabled)</li>
    </ul>
  </span>

  <p id="out-select">Styled select: no action</p>

  <script>
    const trigger = document.getElementById("select-trigger");
    const list = document.getElementById("select-list");
    const out = document.getElementById("out-select");

    function openList(reason) {
      list.hidden = false;
      trigger.setAttribute("aria-expanded", "true");
      out.textContent = "Styled select: opened (" + reason + ")";
    }

    function closeList(reason) {
      list.hidden = true;
      trigger.setAttribute("aria-expanded", "false");
      out.textContent = "Styled select: closed (" + reason + ")";
    }

    function toggleList() {
      const open = trigger.getAttribute("aria-expanded") === "true";
      open ? closeList("toggle") : openList("toggle");
    }

    // Open/close on trigger click
    trigger.addEventListener("click", () => toggleList());

    // IMPORTANT: use mousedown so selection happens BEFORE blur/outside handlers
    list.addEventListener("mousedown", (e) => {
      const option = e.target.closest('[role="option"]');
      if (!option) return;

      if (option.getAttribute("aria-disabled") === "true") {
        out.textContent = "Styled select: disabled option (no action)";
        return;
      }

      e.preventDefault(); // keep behavior stable across browsers
      const value = option.getAttribute("data-value") || option.textContent;

      trigger.textContent = "Selected: " + value;
      out.textContent = 'Styled select: selected "' + value + '"';
      closeList("selected");
    });

    // Close on outside click
    document.addEventListener("mousedown", (e) => {
      if (e.target === trigger || list.contains(e.target)) return;
      closeList("outside click");
    });

    // Close on blur of trigger (delay one tick so list mousedown can run first)
    trigger.addEventListener("blur", () => {
      setTimeout(() => closeList("blur"), 0);
    });
  </script>

</body>
</html>
