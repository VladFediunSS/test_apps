<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Loading Spinner Test</title>
  <style>
    #overlay[hidden],
    #spinner[hidden] {
      display: none;
    }

    #overlay {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.25);
      z-index: 1000;
    }

    #spinner {
      position: fixed;
      top: 50%;
      left: 50%;
      width: 32px;
      height: 32px;
      margin: -16px 0 0 -16px;
      border: 4px solid #ccc;
      border-top-color: #000;
      border-radius: 50%;
      animation: spin 1s linear infinite;
      z-index: 1001;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    .control { margin: 8px 0; }
  </style>
</head>
<body>

  <h1>spinner-test.html</h1>

  <!-- Start with N seconds -->
  <div class="control">
    <label for="sec-input">Seconds:</label>
    <input
      id="sec-input"
      type="number"
      min="0.1"
      step="0.1"
      value="10"
      data-testid="sec-input"
    >
    <button type="button" id="start" data-testid="start">
      Start
    </button>
  </div>

  <!-- Start random -->
  <p>Random time: 1-10s</p>
  <div class="control">
    <button type="button" id="start-random" data-testid="start-random">
      Start random
    </button>
    <div>
      Status: <span id="status" data-testid="status">none</span>
    </div>
  </div>

  <!-- Test button for overlay blocking -->
  <div class="control">
    <button type="button" id="test-btn" data-testid="test-btn">
      Test button
    </button>
    <div>
      State: <span id="test-state" data-testid="test-state">none</span>
    </div>
  </div>

  <!-- Overlay + spinner -->
  <div id="overlay" hidden data-testid="overlay"></div>
  <div
    id="spinner"
    role="status"
    aria-live="polite"
    aria-hidden="true"
    hidden
    data-testid="spinner"
  ></div>

  <script>
    const secInput = document.getElementById("sec-input");
    const startBtn = document.getElementById("start");
    const startRandomBtn = document.getElementById("start-random");

    const overlay = document.getElementById("overlay");
    const spinner = document.getElementById("spinner");
    const status = document.getElementById("status");

    const testBtn = document.getElementById("test-btn");
    const testState = document.getElementById("test-state");

    let timerId = null;
    let loading = false;

    function setStatus(value) {
      status.textContent = value;
    }

    function showSpinner() {
      overlay.hidden = false;
      spinner.hidden = false;
      spinner.setAttribute("aria-hidden", "false");
      loading = true;
      setStatus("loading");
    }

    function hideSpinner() {
      overlay.hidden = true;
      spinner.hidden = true;
      spinner.setAttribute("aria-hidden", "true");
      loading = false;
      setStatus("done");
      timerId = null;
    }

    function startForSeconds(seconds) {
      if (timerId) {
        clearTimeout(timerId);
        timerId = null;
      }
      showSpinner();
      timerId = setTimeout(hideSpinner, seconds * 1000);
    }

    startBtn.addEventListener("click", () => {
      const s = parseFloat(secInput.value);
      const seconds = isFinite(s) && s > 0 ? s : 0.1;
      startForSeconds(seconds);
    });

    startRandomBtn.addEventListener("click", () => {
      const seconds = Math.floor(Math.random() * 10) + 1;
      startForSeconds(seconds);
    });

    testBtn.addEventListener("click", () => {
      if (loading) return; // blocked by overlay
      testState.textContent = "clicked";
    });

    setStatus("none");
  </script>

</body>
</html>
